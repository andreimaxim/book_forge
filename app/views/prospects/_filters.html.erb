<div class="mb-6 p-4 bg-gray-50 rounded-lg">
  <%= form_with url: prospects_path, method: :get, class: "flex flex-wrap gap-4 items-end" do |form| %>
    <% if params[:view] == "pipeline" %>
      <%= form.hidden_field :view, value: "pipeline" %>
    <% end %>

    <div>
      <%= form.label :stage, "Stage", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :stage,
        [["All Stages", ""]] + Prospect.stages.keys.map { |s| [s.humanize, s] },
        { selected: params[:stage] },
        class: "w-full rounded-md border-gray-300 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
    </div>

    <div>
      <%= form.label :source, "Source", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :source,
        [["All Sources", ""]] + Prospect.sources.keys.map { |s| [s.humanize, s] },
        { selected: params[:source] },
        class: "w-full rounded-md border-gray-300 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
    </div>

    <div>
      <%= form.label :agent_id, "Agent", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :agent_id,
        [["All Agents", ""], ["Unassigned", "unassigned"]] + Agent.active.alphabetical.map { |a| [a.full_name, a.id] },
        { selected: params[:agent_id] },
        class: "w-full rounded-md border-gray-300 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
    </div>

    <div>
      <%= form.label :follow_up, "Follow Up", class: "block text-sm font-medium text-gray-700 mb-1" %>
      <%= form.select :follow_up,
        [["Any", ""], ["Today", "today"], ["This Week", "week"], ["Overdue", "overdue"]],
        { selected: params[:follow_up] },
        class: "w-full rounded-md border-gray-300 py-2 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" %>
    </div>

    <div class="flex gap-2">
      <%= form.submit "Filter", class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 cursor-pointer" %>
      <% if params[:stage].present? || params[:source].present? || params[:agent_id].present? || params[:follow_up].present? %>
        <%= link_to "Clear", prospects_path(view: params[:view]), class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md shadow-sm text-gray-700 bg-white hover:bg-gray-50" %>
      <% end %>
    </div>
  <% end %>
</div>
